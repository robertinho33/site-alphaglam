{% extends "layout.html" %}

{% block Título %}
Lista de Atendimentos
{% endblock %}

{% block Conteúdo %}
<h2>Lista de Atendimentos</h2>

<!-- Formulário de Atendimentos -->
<form id="atendimento-form">
    <div class="form-group">
        <label for="nomeCliente">Nome do Cliente:</label>
        <input type="text" id="nomeCliente" class="form-control" required>
    </div>

    <div class="form-group">
        <label for="servico">Serviço:</label>
        <input type="text" id="servico" class="form-control" required>
    </div>

    <div class="form-group">
        <label for="profissional">Profissional:</label>
        <input type="text" id="profissional" class="form-control" required>
    </div>

    <div class="form-group">
        <label for="formaPagamento">Forma de Pagamento:</label>
        <select id="formaPagamento" class="form-control">
            <option>Dinheiro</option>
            <option>Cartão</option>
            <option>Pix</option>
        </select>
    </div>

    <div class="form-group">
        <label for="valorServico">Valor do Serviço (R$):</label>
        <input type="number" id="valorServico" class="form-control" step="0.01" required>
    </div>

    <div class="form-group">
        <label for="desconto">Desconto (%):</label>
        <input type="number" id="desconto" class="form-control" placeholder="Digite o desconto (se houver)">
    </div>

    <div class="form-group form-check">
        <input type="checkbox" id="cortesia" class="form-check-input">
        <label for="cortesia" class="form-check-label">Cortesia</label>
    </div>

    <div class="form-group">
        <label for="dataAtendimento">Data do Atendimento:</label>
        <input type="date" id="dataAtendimento" class="form-control">
    </div>

    <button type="button" class="btn btn-primary" onclick="adicionarAtendimento()">Adicionar Atendimento</button>
</form>

<h3 class="mt-5">Lista de Atendimentos</h3>
<ul id="listaAtendimentos" class="list-group"></ul>

<div class="text-center mt-5">
    <button class="btn btn-primary" onclick="gerarArquivoTexto()">Gerar Arquivo de Texto</button>
    <button id="enviarWhatsApp" class="btn btn-success mt-3" style="display:none;" onclick="enviarParaWhatsApp()">Enviar para WhatsApp</button>
</div>

<script>
    let atendimentos = [];

    function adicionarAtendimento() {
        const nomeCliente = document.getElementById('nomeCliente').value;
        const servico = document.getElementById('servico').value;
        const profissional = document.getElementById('profissional').value;
        const formaPagamento = document.getElementById('formaPagamento').value;
        const valorServico = parseFloat(document.getElementById('valorServico').value);
        const desconto = parseFloat(document.getElementById('desconto').value) || 0;
        const cortesia = document.getElementById('cortesia').checked;
        const dataAtendimento = document.getElementById('dataAtendimento').value;

        const valorFinal = cortesia ? 0 : valorServico - (valorServico * desconto / 100);

        atendimentos.push({ nomeCliente, servico, profissional, formaPagamento, valorFinal, dataAtendimento });

        const lista = document.getElementById('listaAtendimentos');
        const li = document.createElement('li');
        li.classList.add('list-group-item');
        li.textContent = `${nomeCliente} - ${servico} - R$ ${valorFinal.toFixed(2)} - ${profissional}`;
        lista.appendChild(li);

        document.getElementById('atendimento-form').reset();
    }

    function gerarArquivoTexto() {
        let total = 0;
        let conteudo = 'Lista de Atendimentos:\n\n';

        atendimentos.forEach((atendimento, index) => {
            conteudo += `${index + 1}. Nome: ${atendimento.nomeCliente}, Serviço: ${atendimento.servico}, Profissional: ${atendimento.profissional}, Valor: R$ ${atendimento.valorFinal.toFixed(2)}\n`;
            total += atendimento.valorFinal;
        });

        conteudo += `\nTotal dos Serviços: R$ ${total.toFixed(2)}`;

        const blob = new Blob([conteudo], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);

        const a = document.createElement('a');
        a.href = url;
        a.download = 'lista_atendimentos.txt';
        a.click();
        
        document.getElementById('enviarWhatsApp').style.display = 'inline';
        window.textFileUrl = url;
    }

    function enviarParaWhatsApp() {
        const mensagem = `Confira a lista de atendimentos: ${window.textFileUrl}`;
        const url = `https://api.whatsapp.com/send?phone=SEU_NUMERO&text=${encodeURIComponent(mensagem)}`;
        window.open(url, '_blank');
    }
</script>
{% endblock %}
